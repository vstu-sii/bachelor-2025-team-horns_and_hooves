# Требования к модели

## Цель
Разработать ML-систему для анализа данных сна и генерации персонализированных рекомендаций по улучшению качества сна на основе показателей пользователя.

## Типы моделей и роли

### Модель для анализа данных сна и генерации рекомендаций

**Назначение:** Анализ структурированных данных о сне (продолжительность, фазы, эффективность) и генерация персонализированных рекомендаций

**Входные данные:** 
- Демографические данные пользователя (возраст, пол, вес, рост)
- Параметры сна (длительность, фазы, эффективность, фрагментация)
- Исторические данные (опционально)

**Вывод:** Текстовые рекомендации с анализом и конкретными советами

**Модель:** Gemini 2.0 Flash

### Модель для расширенного анализа с RAG

**Назначение:** Улучшение рекомендаций за счет доступа к научной базе знаний о медицине сна

**Входные данные:** 
- Результаты базового анализа
- Релевантные научные статьи и исследования
- Контекст пользователя

**Вывод:** Обоснованные рекомендации с ссылками на исследования

**Модель:** Gemini 2.0 Pro + Vector Database

Gemini 2.0 Flash выбрана как основная модель благодаря оптимальному балансу скорости и качества, бесплатному лимиту в 9M токенов в месяц и отличной поддержке медицинской терминологии на русском языке.

## Требования к производительности

### Latency (задержки)

| Компонент | Целевая задержка | Максимальная задержка |
|-----------|------------------|----------------------|
| Полный цикл анализа сна | 2-4 секунды | 8 секунд |
| Генерация рекомендаций | 1-3 секунды | 6 секунд |
| Пакетная обработка (5 пользователей) | 8-12 секунд | 20 секунд |

### Throughput (пропускная способность)

| Метрика | Требование |
|---------|------------|
| Одновременных пользователей | 20-30 |
| Анализов в час (пиковая нагрузка) | 300-500 |
| Среднее время ответа системы | < 10 секунд |
| Availability (доступность) | 99% |

## Метрики качества

### Анализ данных сна
- **Coverage ключевых метрик** - процент упомянутых значимых параметров сна в анализе (автоматическая оценка + LLM-судья)
- **Problem detection rate** - частота выявления очевидных проблем сна на основе данных (LLM-судья)
- **Data grounding score** - оценка привязки рекомендаций к конкретным цифрам из данных (LLM-судья)

### Генерация рекомендаций
- **ROUGE-L для релевантности** - сравнение с эталонными ответами (автоматическая оценка)
- **Actionability score** - оценка выполнимости и практичности рекомендаций (LLM-судья)
- **Safety compliance** - отсутствие опасных или вредных советов (LLM-судья + автоматическая проверка)
- **Hallucination rate** - процент выдуманных медицинских фактов (автоматическая + LLM проверка)

### Методы измерения
- **Автоматические метрики**: ROUGE-L, BLEU-4, keyword coverage, response length
- **LLM-экспертная оценка**: SleepExpertJudge промпты для анализа coverage, problem detection, actionability
- **Композитный score**: Общая оценка качества от 1 до 10 на основе всех метрик

### Целевые показатели
| Метрика | Текущий результат | Целевой показатель |
|---------|------------------|-------------------|
| Coverage метрик | ~85% | ≥ 90% |
| Problem detection | 7.5/10 | ≥ 8.5/10 |
| Actionability score | 7.0/10 | ≥ 8.0/10 |
| Safety compliance | 9.0/10 | ≥ 9.5/10 |
| Композитный score | 7.8/10 | ≥ 8.5/10 |

## Ограничения

### Функциональные ограничения
- **Максимальный объем данных за раз:** 7 дней истории сна
- **Поддерживаемые метрики:** продолжительность, фазы сна, эффективность, фрагментация, пульс
- **Форматы данных:** структурированные JSON-объекты через API
- **Максимум операций в час:** 500
- **Лимит токенов на запрос:** 2000 (вход + выход)

### Технические ограничения
- **Зависимость от внешнего API:** Google Gemini
- **Требуемые библиотеки:** google-genai, python-dotenv, numpy
- **Хранение данных:** локальная база данных с пользовательскими метриками сна

### Медицинские ограничения
- **Не является медицинским устройством**
- **Рекомендации носят информационный характер**
- **Требуется консультация специалиста для медицинских диагнозов**
