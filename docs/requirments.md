
# Требования к системе

## 1. Функциональные требования

1. **FR-1. Регистрация пользователя**
    * Система должна позволять пользователю зарегистрироваться, указав e-mail, пароль, пол, рост, вес и дату рождения.
    * После регистрации пользователь перенаправляется на страницу входа.
    * Должна выполняться проверка корректности введённых данных.

2. **FR-2. Авторизация пользователя**
    * Пользователь должен иметь возможность входить в личный кабинет по логину (e-mail) и паролю.
    * При неверных данных система сообщает об ошибке.
    * При успешном входе открывается главная страница.

3. **FR-3. Восстановление пароля**
    * Пользователь может запросить восстановление пароля, введя свой e-mail.
    * Система отправляет ссылку для сброса пароля.

4. **FR-4. Загрузка данных**

    * Пользователь может загружать данные сна в формате CSV, экспортированные с устройства-трекера.
    * Система должна валидировать структуру и формат данных (время сна, длительность, фазы, пульс и т.д.), отбросив лишние данные, такие как количество шагов и подобное.

5. **FR-5. Автоматическая валидация и сохранение данных**
    * При загрузке данных выполняется проверка диапазонов, дубликатов и формата.
    * Только корректные данные сохраняются в базе.

6. **FR-6. Расчёт метрик сна**
    * Система вычисляет метрики сна: латентность, эффективность сна, фазы (глубокий, лёгкий, REM), индекс фрагментации, калории во сне, регулярность и хронотип.
    * Метрики сохраняются в истории пользователя.

7. **FR-7. Оценка качества сна (Модель 1)**
    * Модель анализирует последнюю ночь сна и формирует оценку (0–100) и текстовую сводку состояния сна.
    * Результат сохраняется и используется следующей моделью.

8. **FR-8. Генерация рекомендаций (Модель 2, RAG)**
    * Модель получает сводку от первой модели и анализ данных за последние 7 дней.
    * Из векторной базы научных источников извлекаются релевантные материалы.
    * Генерируется персональный текст с конкретными шагами улучшения сна и прогнозом ожидаемого эффекта.
    * Результат сохраняется в профиле пользователя.

9. **FR-9. Просмотр текущего состояния сна**
    * Пользователь может видеть данные последней ночи, включая оценку качества сна и ключевые показатели.

10. **FR-10. Просмотр истории сна**
    * Пользователь может просматривать историю сна за неделю, месяц.
    * Отображаются графики, средние значения, динамика изменений.

11. **FR-11. Просмотр хронотипа и метаболизма**
    * Система отображает рассчитанный тип хронотипа (жаворонок, голубь, сова) и соответствующие общие рекомендации по времени засыпания и пробуждения.
    * Показываются значения BMR и калорий, сожжённых во сне.

12. **FR-12. Просмотр персональных рекомендаций**
    * Пользователь может просматривать сохранённые рекомендации и историю изменений.

---

## 2. Нефункциональные требования

1. **Производительность и масштабируемость**
    * Время отклика системы при нормальной нагрузке — не более 3 секунд.
    * Обработка отчёта ИИ-модели — не более 10 секунд.
    * Система должна выдерживать до 100 параллельных пользователей без деградации производительности.
    * Поддержка масштабирования с помощью очередей задач и кэша.

2. **Надёжность и отказоустойчивость**
    * При сбое одного из компонентов система должна сохранять работоспособность.
    * Ежедневное резервное копирование данных.
    * RTO (время восстановления после сбоя) ≤ 1 час.
    * Транзакционная запись данных (исключить частичные сохранения).

3. **Безопасность и защита данных**
    * Пароли — только в зашифрованном виде (bcrypt).
    * Защита от CSRF и SQL-инъекций.
    * Ограничение числа попыток входа и восстановления пароля.
    * Возможность удаления аккаунта и данных пользователя.

4. **Совместимость и переносимость**
    * Поддержка современных браузеров.
    * Адаптивная верстка для мобильных устройств.
    * Совместимость с различными форматами CSV и локалями.
    * Возможность развёртывания на Docker-среде или облаке.

5. **Поддерживаемость и расширяемость**

    * Модульная архитектура, допускающая добавление новых ИИ-моделей без изменения ядра системы.
    * Комментированный и документированный код.

6. **Используемость**

    * Простая и понятная навигация.
    * Ясные сообщения об ошибках.
    * Минимум 2 способа попасть к нужной функции (история сна доступна через меню и дашборд).
    * Время загрузки интерфейса ≤ 2 секунд.

7. **Ограничения**

    * Максимальный размер загружаемого CSV — 50 МБ.
    * Максимум 10 запросов к ИИ-модели в сутки для одного пользователя.

