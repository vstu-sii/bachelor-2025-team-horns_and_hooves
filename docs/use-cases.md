# D2 — Use-case Narrative

## UC-1. Регистрация

**Акторы:** Пользователь.

**Предусловия:**

* Пользователь ещё не зарегистрирован в системе.

**Триггер:** Пользователь инициирует процесс регистрации.

## Happy Path

1. **Пользователь** вводит данные для регистрации (имя, email, пароль и др.).
2. **Система** валидирует введённые данные (проверка email, корректность пароля).
3. **Система** создаёт новый аккаунт пользователя.
4. **Система** подтверждает успешную регистрацию и направляет пользователя на страницу входа.

**Ценность:** быстрый и безопасный процесс создания нового аккаунта.

## Альтернативы

**A1. Некорректный email**

* Обнаружение: email не проходит валидацию.
* Действия: показать ошибку, предложить ввести корректный email.
* **Ценность:** снижение ошибок при вводе данных.

**A2. Пароль слишком слабый**

* Обнаружение: пароль не соответствует требованиям безопасности.
* Действия: отобразить требования к паролю, предложить пользователю выбрать более надёжный.
* **Ценность:** повышение безопасности пользователей.

## Ошибки

**E1. Технический сбой при регистрации**

* Обработка: уведомление об ошибке, перезагрузка формы.
* **Ценность:** ясность при ошибке и возможность повторной попытки.

**E2. Дублирующийся аккаунт**

* Обработка: система проверяет, есть ли аккаунт с таким же email.
* **Ценность:** предотвращение создания нескольких аккаунтов с одним email.


**E3. Неудачный переход на страницу входа после регистрации **

* **Обработка:** система не может выполнить редирект на страницу входа после регистрации (из-за проблемы с сервером, ошибкой в URL или сетевым сбоем). В этом случае система отображает сообщение о невозможности завершить регистрацию и предлагает пользователю обновить страницу.
* **Ценность:** ясные шаги для пользователя в случае сбоев, минимизация фрустрации и понятные указания для входа.


---


## UC-2. Вход в личный кабинет

**Акторы:** Пользователь.

**Предусловия:**

* Пользователь зарегистрирован в системе.

**Триггер:** Пользователь вводит данные для входа.

## Happy Path

1. **Пользователь** вводит логин и пароль.
2. **Система** валидирует данные (проверка корректности логина и пароля).
3. **Система** направляет пользователя в главную страницу.

**Ценность:** быстрый и безопасный доступ к аккаунту.

## Альтернативы

**A1. Некорректный логин или пароль**

* Обнаружение: неверные данные для входа.
* Действия: показать ошибку и предложить повторить попытку.
* **Ценность:** ясность при ошибке.


**A2. Плохое интернет-соединение**

* Обнаружение: система не может получить данные для авторизации из-за плохого интернет-соединения (тайм-аут при отправке данных на сервер).
* Действия: система отображает уведомление о проблемах с интернет-соединением и предлагает пользователю проверить сеть или повторить попытку позже.
* **Ценность:** информирование пользователя о проблемах с сетью и возможность повторной попытки.

## Ошибки

**E1. Технический сбой при входе**

* Обработка: сообщение об ошибке, предложение повторить попытку позже.
* **Ценность:** стабильность работы системы.

**E2. Превышение лимитов на количество входов**

* Обработка: временная блокировка входа, предложение восстановить доступ через email.
* **Ценность:** предотвращение атак, безопасность.

**Постусловия:** Пользователь успешно вошёл в личный кабинет.


** E3. Ошибка в базе данных (учётная запись отсутствует) **

* Обработка: система не может найти учётную запись с введёнными данными (например, ошибка в базе данных или неправильный email).
* **Ценность**: ясная информация для пользователя, что учётная запись отсутствует или некорректно введены данные, возможность перейти к созданию аккаунта.

---


## UC-3. Восстановление аккаунта

**Акторы:** Пользователь.

**Предусловия:**

* Пользователь забыл пароль.

**Триггер:** Пользователь инициирует восстановление пароля.

## Happy Path

1. **Пользователь** запрашивает восстановление пароля.
2. **Система** отправляет ссылку на email для сброса пароля.
3. **Пользователь** переходит по ссылке и вводит новый пароль.
4. **Система** обновляет пароль и подтверждает изменение.

**Ценность:** быстрый процесс восстановления доступа.

## Альтернативы

**A1. Некорректный email**

* Обнаружение: email не зарегистрирован.
* Действия: показать ошибку, предложить проверить введённые данные.
* **Ценность:** снижение ошибок.

**A2. Истёк срок действия ссылки**

* Обнаружение: ссылка на сброс пароля просрочена.
* Действия: предложить запросить новую ссылку.
* **Ценность:** стабильный процесс восстановления.

## Ошибки

**E1. Технический сбой при восстановлении**

* Обработка: сообщить о проблемах, предложить повторить операцию позднее.
* **Ценность:** стабильность работы сервиса.

**E2. Превышение лимитов**

* Обработка: лимит запросов на восстановление, уведомление об ограничении.
* **Ценность:** предотвращение злоупотреблений.

** E3. Ошибка верификации нового пароля **

* Обработка: при попытке установить новый пароль, система обнаруживает ошибку в процессе верификации ( пароль не соответствует требованиям безопасности, таким как длина или сложность).
* **Ценность**: повышение безопасности за счёт проверки на сильные пароли, предотвращение ошибок при вводе.

---

## UC-4. Загрузка данных

**Акторы:** Пользователь.

**Предусловия:**

* Пользователь зарегистрирован и авторизован.
* Устройство синхронизировано и готово для передачи данных.

**Триггер:** Пользователь запрашивает загрузку данных о сне.

## Happy Path

1. **Пользователь** загружает данные из устройства через csv.
2. **Система** получает данные.
3. **Система** валидирует данные (формат, диапазоны, поиск необходимых данных).
4. **Система** сохраняет данные в базе и предоставляет пользователю уведомление о успешной загрузке.
5. **Система** обновляет данные о текущем сне в пользовательском профиле.

**Ценность:** простота загрузки данных с устройства, минимизация ошибок и быстрая синхронизация.

## Альтернативы

**A1. Дублирующиеся записи в файле**

* Обнаружение: система обнаруживает дублирующиеся записи в файле (например, дважды загруженная одна и та же ночь сна).
* **Ценность**: поддержка целостности данных, предотвращение ошибок и дублирования.

**A2. Неверный формат данных**

* Обнаружение: загружаемые данные имеют тип отличный от csv.
* Действия: заблокировать отправку данных и пояснить пользователю о поддерживаемых типов.
* **Ценность:** корректность данных и ясные шаги по исправлению.

## Ошибки

**E1. Технический сбой при синхронизации**

* Обработка: авто-повтор.
* **Ценность:** непрерывность работы и поддержка ожиданий пользователя.

**E2. Некорректные данные** (неправильный формат данных)

* Обработка: сообщение о некорректных данных, подсказки для исправления.
* **Ценность:** ясность и простота исправлений.

**E3. Превышение лимитов на количество данных**

* Обработка: ограничение объёма данных, автоматическая агрегация/обрезка.
* **Ценность:** стабильная работа сервиса без перегрузок.

---

## UC-5. Просмотр текущего состояния сна

**Акторы:** Пользователь.
**Предусловия:**

* Пользователь зарегистрирован и авторизован.
* За выбранный период есть данные/агрегаты.
* Система доступна для запросов пользователя.

**Триггер:** Пользователь запрашивает статистику за период.

## Happy Path

1. **Пользователь** выбирает период и параметры просмотра.
2. **Система** готовит агрегированные показатели за период (латентность, эффективность сна, распределение фаз, индекс фрагментации, качество по дням, регулярность).
3. **Система** предоставляет пользовательский обзор: графики и сводные показатели с возможностью уточнить период/параметры.
4. **Пользователь** изменяет период/параметры; **Система** обновляет обзор.

**Ценность:** быстрая диагностика трендов; экономия времени на подготовку отчётов; снижение ошибок интерпретации.

## Альтернативы

**A1. Недостаточно данных для выбранного периода**

* Предложить расширить период или собрать недостающие записи; показать частичный обзор, если это возможно.
* **Ценность:** понятные ожидания и польза даже при неполном наборе.

**A2. Очень большой период**

* Предложить предустановленные интервалы и укрупнённый обзор.
* **Ценность:** стабильная скорость и читаемость показателей.

## Ошибки

**E1. Технический сбой** (временная недоступность статистики)

* Обработка: сообщить о задержке; предложить повторить запрос; при возможности показать сохранённый ранее обзор.
* **Ценность:** прозрачность, сохранение контроля у пользователя.

**E2. Некорректный ввод** (выбран недопустимый период: будущая неделя/месяц или период раньше даты первой записи/регистрации)

* **Обработка:** система автоматически переходит к ближайшему доступному периоду (последняя доступная неделя/месяц в будущем направлении или первая доступная в прошлом) и сообщает, что выбранный период недоступен; предлагает перейти к «последнему доступному периоду» или «первой доступной записи».
* **Ценность:** меньше «пустых» экранов и лишних действий, экономия времени на навигацию, понятные границы доступной истории.


**E3. Превышение лимитов** (слишком много точек для отображения графиков)

* Обработка: объединять близкие по времени точки в усреднённые интервалы (например, в пределах нескольких минут), по возможности сохраняя сведения о диапазонах значений в интервале.
* **Ценность:** быстрый отклик без «подвисаний» и читаемые графики без шума дубликатов.

**Постусловия:** Выбранный период и параметры сохраняются как предпочтения пользователя; обзор доступен для повторного просмотра.
**Критерии приёмки:** Загрузка обзора ≤ *X* сек при объёме данных ≤ *Y* записей; корректная смена периода/параметров без срыва просмотра; при укрупнении серии указано, что данные агрегированы.

---



## UC-6. Просмотр истории сна

**Акторы:** Пользователь.

**Предусловия:**

* Пользователь зарегистрирован и авторизован.
* Доступны записи сна за выбранный период.

**Триггер:** Пользователь запрашивает историю сна.

## Happy Path

1. **Пользователь** выбирает период (например, за неделю/месяц).
2. **Система** отображает записи сна за этот период.
3. **Пользователь** может увидеть статистику по каждой ночи.

**Ценность:** доступ к данным за выбранный период для анализа трендов.

## Альтернативы

**A1. Нет данных за выбранный период**

* Обнаружение: отсутствуют записи за период.
* Действия: показать сообщение «Нет данных за выбранный период».
* **Ценность:** понятные ожидания.

## Ошибки

**E1. Технический сбой**

* Обработка: уведомление об ошибке, попытка повторить запрос.
* **Ценность:** поддержка пользователей.

** E2. Превышение лимита времени отклика**

* Обработка: если запрос к базе данных или визуализация занимает слишком много времени, система показывает сообщение о задержке и предложит подождать или уменьшить объём данных для запроса.
* **Ценность**: поддержание отзывчивости системы при больших объёмах данных.

---

## UC-7. Просмотр хронотипа

**Акторы:** Пользователь.

**Предусловия:**

* Пользователь зарегистрирован и авторизован.
* Антропометрия заполнена при регистрации и валидна (вес, рост, дата рождения → возраст, пол).
* В наличии записи сна за ≥7 дней; для корректной оценки середины сна предпочтительны «свободные дни».
* Система доступна для запросов пользователя.

**Триггер:** Пользователь запрашивает анализ хронотипа и метаболизма.

## Happy Path
1. **Пользователь** запроашивает данные о своём хронотипе.
2. **Пользователь** просматривает данные о хронортипе.

**Ценность:** персональные ориентиры по режиму сна и энергетике; экономия времени на самостоятельные расчёты; база для последующих рекомендаций.

## Альтернативы

**A1. Недостаточно «свободных дней»**

* Обнаружение: «свободных» ночей слишком мало для надёжной оценки. → Показать «Точность снижена», выдать оценку по доступным дням и подсказать, какие записи помогут улучшить точность.
* **Ценность:** непрерывная польза даже при неполных данных; ясные шаги по улучшению.

**A2. Определён хронотип, но отсутствует текстовое описание**

* Обнаружение: для определённого типа нет локализованного описания. → Показать тип и рассчитанное время середины сна; уведомить, что текстовое описание недоступно.
* **Ценность:** пользователь получает результат (без «пустого экрана») и понимает, что именно отсутствует.

## Ошибки

**E1. Технический сбой** (временная недоступность функции анализа)

* Обработка: сообщить о временной недоступности; предложить повторить запрос позднее; показать последний успешный результат, если он есть.
* **Ценность:** непрерывность работы и предсказуемость.

**E2. Некорректные данные профиля** (пустые/нереалистичные значения)

* Обработка: сообщить, какие поля профиля нужно уточнить; предложить обновить профиль и повторить анализ.
* **Ценность:** снижение ошибок расчёта; быстрый путь к корректному результату.

**E3. Превышение лимитов набора данных** (запрошен объём больше поддерживаемого вычислением хронотипа)

* Обработка: выполнить анализ по последним 7 записям; уведомить, что применён лимит периода; при дефиците «свободных» ночей — отразить сниженную точность.
* **Ценность:** предсказуемое время расчёта и понятные границы анализа.

**Постусловия:** Сохранены BMR, калории сна, тип хронотипа и рекомендуемое окно сна; результат доступен для последующего использования в рекомендациях.
**Критерии приёмки:** Возвращены численные значения BMR и калорий сна, тип хронотипа и окно сна; при дефиците «свободных» дней отображается пониженная точность; время получения результата ≤ *X* сек при периоде ≤ *Y* дней.
