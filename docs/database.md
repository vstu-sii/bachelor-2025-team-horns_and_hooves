# Описание связей:

### 1. **users и user_data (Один к одному)**:

* Каждый пользователь (`users`) может иметь только одну запись в таблице `user_data`, которая содержит информацию о его антропометрии, включая вес, рост, пол, дату рождения и другие данные.
* Связь осуществляется через `user_data.user_id`, который ссылается на `users.id`.
* **ON DELETE CASCADE**: При удалении пользователя все связанные с ним данные в таблице `user_data` также будут удалены.

### 2. **users и sleep_record (Один ко многим)**:

* Каждый пользователь (`users`) может иметь множество записей о сне (`sleep_record`).
* Связь осуществляется через `sleep_record.user_id`, который ссылается на `users.id`.
* **ON DELETE CASCADE**: При удалении пользователя все его записи о сне будут удалены.

### 3. **sleep_record и night_heart_rate_entry (Один ко многим)**:

* Каждая запись о сне (`sleep_record`) может иметь несколько записей пульса ночью (`night_heart_rate_entry`).
* Связь осуществляется через `night_heart_rate_entry.record_id`, который ссылается на `sleep_record.id`.
* **ON DELETE CASCADE**: При удалении записи о сне все связанные с ней записи пульса будут удалены.

### 4. **sleep_record и sleep_segment (Один ко многим)**:

* Каждая запись о сне (`sleep_record`) может содержать несколько сегментов сна (`sleep_segment`).
* Связь осуществляется через `sleep_segment.record_id`, который ссылается на `sleep_record.id`.
* **ON DELETE CASCADE**: При удалении записи о сне все связанные с ней сегменты сна будут удалены.

### 5. **users и sleep_statistics (Один ко многим)**:

* Каждый пользователь (`users`) может иметь несколько записей статистики сна (`sleep_statistics`), связанных с ним.
* Связь осуществляется через `sleep_statistics.user_id`, который ссылается на `users.id`.
* **ON DELETE CASCADE**: При удалении пользователя все его статистики сна будут удалены.

---

# Индексы для производительности:

### 1. **idx_sleep_record_user_sleep_date_time**:

* Индекс ускоряет поиск записей о сне для конкретного пользователя по времени сна. Это ключевая операция для получения данных о сне по датам для отображения статистики на пользовательских страницах.

### 2. **idx_sleep_statistics_user_date**:

* Индекс ускоряет выборку статистики сна для конкретного пользователя по дате. Это используется для отображения статистики по дням или месяцам на страницах пользователя.

---

# Схема для LLM данных

Для работы с LLM и генерации рекомендаций используются следующие поля в таблице **sleep_statistics**:

* **sleep_quality (FLOAT)**: Сохраняет числовую оценку качества сна (от 0 до 100).

* **recommended (TEXT)**: Сохраняет текстовые рекомендации по улучшению качества сна. 
